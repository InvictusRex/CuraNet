# .ebextensions/python.config
option_settings:
  aws:elasticbeanstalk:application:environment:
    PYTHONPATH: "/var/app/current:/var/app/current/backend"
    DB_HOST: "curanet-db.cliek6io2ac7.eu-north-1.rds.amazonaws.com"
    DB_USER: "admin"
    DB_PASSWORD: "Database12!"
    DB_NAME: "curanet_db_test"
  aws:elasticbeanstalk:container:python:
    WSGIPath: application:application

packages:
  yum:
    git: []

container_commands:
  01_install_dependencies:
    command: |
      echo "Installing Python dependencies..."
      pip install --upgrade pip
      pip install -r requirements.txt

  # 02_validate_app:
  #   command: |
  #    echo "Validating FastAPI app import..."
  #    python -c "import sys; sys.path.insert(0, '/var/app/current/backend'); from backend.main import app; print('✅ FastAPI app imported successfully')"

  03_run_migrations:
    command: |
      echo "Running Alembic migrations (if any)..."
      cd backend
      if [ -f alembic.ini ]; then
        alembic upgrade head || echo "⚠️ Alembic migration skipped or failed safely"
      else
        echo "ℹ️ Alembic config not found, skipping migration"
      fi