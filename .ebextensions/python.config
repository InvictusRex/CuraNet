# .ebextensions/python.config
option_settings:
  aws:elasticbeanstalk:application:environment:
    PYTHONPATH: "/var/app/current:/var/app/current/backend"
    DB_HOST: "curanet-db-2.coloy0ku6zmn.us-east-1.rds.amazonaws.com"
    DB_USER: "admin"
    DB_PASSWORD: "Database12!"
    DB_NAME: "curanet_db_test"
  aws:elasticbeanstalk:container:python:
    WSGIPath: application:application

packages:
  yum:
    git: []

container_commands:
  01_install_dependencies:
    command: |
      echo "Installing Python dependencies..."
      pip install --upgrade pip
      pip install -r requirements.txt

  02_validate_app:
    command: |
      echo "Validating FastAPI app import..."
      cd /var/app/current
      python -c "from application import application; print('FastAPI app imported successfully')"

  03_create_tables:
    command: |
      echo "Creating database tables..."
      cd /var/app/current
      python -c "from backend.database import engine; from backend.models import Base; Base.metadata.create_all(bind=engine); print('Database tables created')" || echo "Database connection failed - tables will be created on first request"