packages:
  yum:
    git: []

container_commands:
  01_install_dependencies:
    command: |
      echo "Installing Python dependencies..."
      pip install --upgrade pip
      pip install -r requirements.txt
  02_set_pythonpath:
    command: |
      echo "Setting PYTHONPATH..."
      echo 'export PYTHONPATH=$PYTHONPATH:/var/app/current:/var/app/current/backend' >> /opt/elasticbeanstalk/env.vars
  03_validate_app:
    command: |
      echo "Validating FastAPI app import..."
      python -c "import sys; sys.path.insert(0, '/var/app/current/backend'); from backend.main import app; print('FastAPI app imported successfully')"
  04_run_migrations:
    command: |
      echo "Running Alembic migrations..."
      cd backend
      alembic upgrade head || echo "Migration skipped or already up-to-date"

